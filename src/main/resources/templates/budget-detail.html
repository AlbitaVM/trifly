{{>header}}
<main class="form-container">
  <div class="container" style="max-width: 1200px;">
    <!-- Header -->
    <div class="budget-page-header">
      <div>
        <h1 class="budget-main-title">{{budgetDetail.budgetName}}</h1>
        <p class="budget-subtitle">Gestiona tus gastos y mantente dentro del presupuesto.</p>
      </div>
      <a class="btn btn-danger btn-lg" href="/bill/{{budgetDetail.id}}/new">
        <span class="material-symbols-outlined">add</span>
        Añadir Gasto
      </a>
    </div>

    <!-- Resumen del presupuesto -->
    <div class="budget-summary">
      <div class="budget-summary-card">
        <p class="budget-card-label">Total Gastado</p>
        <h2 class="budget-card-amount">{{budgetDetail.totalSpent}}{{budgetDetail.currencySymbol}}</h2>
      </div>
      <div class="budget-summary-card">
        <p class="budget-card-label">Presupuesto Restante</p>
        <h2 class="budget-card-amount budget-remaining">{{budgetDetail.remaining}}{{budgetDetail.currencySymbol}}</h2>
      </div>
      <div class="budget-summary-card">
        <p class="budget-card-label">Presupuesto Total</p>
        <h2 class="budget-card-amount">{{budgetDetail.total}}{{budgetDetail.currencySymbol}}</h2>
      </div>
    </div>

    <!-- Tabla de gastos -->
    <div class="expenses-section">
      <h2 class="expenses-title">Desglose de Gastos</h2>
      <div class="expenses-card">
        <table class="expenses-table">
          <thead>
            <tr>
              <th>CATEGORÍA</th>
              <th>GASTO</th>
              <th>PORCENTAJE</th>
            </tr>
          </thead>
          <tbody>
             {{#budgetDetail.categories}}
            <tr>
              <td class="expense-category">{{categoryName}}</td>
              <td class="expense-amount">{{spent}}{{budgetDetail.currencySymbol}}</td>
              <td class="expense-progress">
                <div class="progress-bar-container">
                  <div class="progress-bar-fill {{categoryClass}}" data-width="{{percentage}}%"></div>
                </div>
                <span class="progress-percentage">{{percentage}}%</span>
              </td>
              <td>
                <div class="list-item-actions">
                  <a href="/budget/{{id}}/edit" class="btn-icon-edit" title="Editar">
                    <span class="material-symbols-outlined">edit</span>
                  </a>
                  <form method="post" action="/budget/{{id}}/delete"   style="display: inline-flex; margin: 0; padding: 0;">
                    <input type="hidden" name="_csrf" value="{{token}}">
                  <button type="submit" class="btn-icon-delete" title="Eliminar">
                    <span class="material-symbols-outlined">delete</span>
                  </button>
                  </form>
                </div>
              </td>
            </tr>
            {{/budgetDetail.categories}}
          </tbody>
        </table>
      </div>
    </div>
  </div>
  {{#budgetDetail.overBudget}}
  <div class="alert alert-danger">
    ⚠ Has sobrepasado tu presupuesto en 
    <strong>{{budgetDetail.exceededAmount}}{{budgetDetail.currencySymbol}}</strong>
    ({{budgetDetail.exceededPercentage}}%)
  </div>
  {{/budgetDetail.overBudget}}
</main>

<script>
  // Animar las barras de progreso
  document.addEventListener('DOMContentLoaded', function() {
    const bars = document.querySelectorAll('.progress-bar-fill');
    bars.forEach(bar => {
      const width = bar.getAttribute('data-width');
      bar.style.width = '0%';
      setTimeout(() => {
        bar.style.transition = 'width 1s ease-in-out';
        bar.style.width = width;
      }, 100);
    });
  });
</script>
{{>footer}}

